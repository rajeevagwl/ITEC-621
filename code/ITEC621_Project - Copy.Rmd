---
title: "Fatal Drug Overdose EDA"
author: "Kheirallah Samaha"
date: "1/26/2021"
output: 
  html_document:
      toc: true
---

```{r setup, include = FALSE}

knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

```

# Introduction

Drug abuse is a huge problem that makes individual drug users the first victims. and drugs also affect all of us, wherever we live and whatever we do. And Drug abuse can cause serious physical and mental problems that can tear apart the family and make our life hard and impossible sometimes.

Stealing from parents and companies or from individuals to get money for drugs causes big conflicts and income loss to the victims and their families. and it may end up in many sad forms such like Arrests and jailing and even death, so Drug abuse is destroying the lives of many teens and adults and is also destroying families across the world.

According to the above introduction, i have decided to go through this data-set to find some information that i do not know about .

This data-set , in general, is a good Dataset for EDA and explanatory analysis. So let us see what this data-set can give us in terms of Drug overdose Deaths.

OK! lets load some libraries

## Load libraries

```{r Load libraries}

library("tidyverse")
library("tidytext")
library("lubridate")
library("DT")
library("skimr")
library("janitor")
library("ggthemes")
library("RColorBrewer")
library("viridis")
library("wordcloud")
library("patchwork")

theme_set(theme_light())

```

-   **Tidyverse**: The tidyverse is an opinionated **collection of R packages** designed for data science:

-   **Tidytext**: can make many text mining tasks easier and more effective.

-   **Lubridate**: Makes easier to do the things with date-times.

-   **Skimr**: Designed to provide summary statistics about variables.

-   **Janitor**: For examining and cleaning dirty data.

-   **DT**: Make it easier to explore data with highlights.

-   **ggthemes**: Collections of Beautiful themes.

-   **RColorBrewer**: Contains a ready-to-use color palettes.

-   **Viridis**: Contains a ready-to-use color palettes.

-   **wordcloud**: word cloud plot.

-   **patchwork**: Arrange multiple plots together.

## Import data

```{r Import data}


DrugDeath <- read_csv("../input/drug-overdose-deaths/drug_deaths.csv")

DrugDeath <- DrugDeath %>% clean_names()

DrugDeath %>% summary()

```

## First touch

```{r First touch }

datatable(DrugDeath %>% count(location, sort = T),
          caption = NULL,
          options = list(dom = 't'))

datatable(DrugDeath %>% count(mannerof_death, sort = T),
          caption = NULL,
          options = list(dom = 't'))
datatable(DrugDeath %>% count(residence_state, sort = T),
          caption = NULL,
          options = list(dom = 't'))

```

It is not a good sign, we have different letter cases, so we have to check all variables to see if we have same problem as mannerof_death! meanwhile, i will take a direct action of converting all observations, except residence_state, to Title case.

I have one comment here about the dataset, if we look at the resident_state variable, we can see that the majority of the dead are from CT State and lot of NA! ust a comment!



## Convert to Title case.

```{r Convert to Title case }

DrugDeath <- DrugDeath %>% mutate_all(list(str_to_title)) %>% 
  mutate(residence_state =  toupper(residence_state), 
         date = mdy_hms(date))


datatable(DrugDeath %>% count(mannerof_death, sort = T),
          caption = NULL,
          options = list(dom = 't'))


```

Well, that is better, I would have converted them all to Uppercase, but to be in safe side, it is better to use Title case, lets see !!


## Missing data

```{r Missing data}

DrugDeath %>% skim() %>% filter(n_missing != 0) %>% 
  ggplot( aes(x = fct_reorder(skim_variable, n_missing), y = n_missing, fill = skim_variable, label = n_missing))+
  geom_col()+
  geom_text(size = 3.5, hjust = -0.25, vjust = 0.25 )+
  coord_flip()+
  theme(axis.text.x = element_text(angle = 90))+
  scale_y_continuous(expand = expansion(add = c(0, 500))) +
  theme(legend.position = "none")+
  scale_fill_viridis(discrete = TRUE, option = "C")+
  labs(
    title = "Missing Data distribution using skimr package",
    subtitle = "Plot, Missing Data distribution",
    caption = "Data source: Kaggle.com, Drug overdose deaths",
    x = "Variable name",
    y = "Count"
  )

```

Good news! the variables those i will work with them in this notebook are OK in terms of missing data! those are date, age, sex, race, residence_city,death_city,location, cod,heroin, cocaine, fentanyl, fentanyl_analogue, oxycodone, oxymorphone, ethanol, hydrocodone, benzodiazepine, methadone, amphet, tramad, morphine_not_heroin, hydromorphone, other, opiate_nos, any_opioid and mannerof_death.

Im not going to take any action about missing data! so I will proceed according to plan!


## Create a new data frame using pivot_longer

Lets now create a new data frame using pivot_longer from dplyr package

```{r pivot longer }

DrugsPivot <-
  DrugDeath %>% select(
    "id",
    "date",
    "residence_state",
    "age",
    "race",
    "sex",
    "cod",
    "mannerof_death",
    "location",
    "heroin",
    "fentanyl",
    "fentanyl_analogue",
    "morphine_not_heroin",
    "cocaine",
    "oxycodone",
    "oxymorphone",
    "ethanol",
    "hydrocodone",
    "benzodiazepine",
    "methadone",
    "amphet",
    "tramad",
    "hydromorphone"
  ) %>% mutate(fentanyl = str_extract(fentanyl, "^.{1}")) %>% 
  pivot_longer(
    cols = c(
    "heroin",
    "fentanyl",
    "fentanyl_analogue",
    "cocaine",
    "oxycodone",
    "oxymorphone",
    "morphine_not_heroin",
    "ethanol",
    "hydrocodone",
    "benzodiazepine",
    "methadone",
    "amphet",
    "tramad",
    "hydromorphone"
    ),
    names_to = "drug_name",
    values_to = "value",
    values_drop_na = TRUE,
  ) %>%
  mutate(across(-date, ~ replace_na(.x, "Unknown"))) %>% 
  mutate(value = as.numeric(value))

dim(DrugsPivot)

```

Something strange happened here, the number of rows are to much, there are lot of duplicates! Lets find out what is going on!

lets Count the number of duplicates by the id variable!

```{r Count the number of duplicates}
 
  datatable(DrugsPivot %>%
  group_by(id) %>%
  summarise(Count = sum(value), .groups = "drop") %>%
    arrange(desc(Count)) %>% count(Count,sort = TRUE),
          caption = NULL,
          options = list(dom = 't'))

```

Well, when I used pivot_longer by Drug names and since there are so many people died from using multiple drugs, the pivot_longer assigned many rows for them.

Now, for example the sex variable became more than it should be! This will give us a false proportion of this variable and so on. But this will not affect the outcome related to drug names proportions.

BTW, Im curious to know who used 7 drugs in one session? interesting! Yes?

OK let us proceed with keeping in mind this issue!

lets check the Gender proportion


### Male and Female OR Female and Male...

```{r Male and Female}

DrugDeath %>% select(sex) %>% 
  filter(!is.na(sex),
         sex != "Unknown") %>% 
  count(sex, sort = TRUE) %>% 
  mutate(percent = paste0(round(n/sum(n) * 100,0),"%")) %>% 
  ggplot(aes(x = sex, y = n, label = percent, fill = sex)) +
  geom_bar(stat = "identity") +
  geom_text(col = "black" , vjust = 1.5, fontface = "bold", size = 5) +
  scale_fill_tableau(palette = "Nuriel Stone") +
  theme(legend.position = "none") +
  labs(
    title = "Male and Female",
    subtitle = "Plot, check the Gender proportion",
    caption = "Data source: Kaggle.com, Drug overdose deaths",
    x = "Sex",
    y = "Count"
  )
  
```

Male 74% while the Female 26% we have to keep in mind this proportion!

lets move on, in general, it is a depressing figure! regardless fo the Gender!


## Question:

What drugs are most popular among The dead (by Gender)?

```{r What drugs are most popular among The dead by Gender}


DrugsPivot %>%
  filter(value != 0,
         sex != "Unknown") %>%
  group_by(drug_name, sex) %>%
  summarise(Count = sum(value), .groups = "drop") %>%
  ungroup() %>%
  mutate(sex = as.factor(sex),
         drug_name = reorder_within(drug_name, Count, sex)) %>% 
  mutate(countsum = sum(Count)) %>% 
  ggplot(aes(
    x = fct_reorder(drug_name, Count),
    y = Count,
    label = Count,
    fill = drug_name
  )) +
  geom_col(width = 0.8) +
  scale_y_continuous(expand = expansion(add = c(0, 600))) +
  geom_text(hjust = -0.1, size = 3.5) +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(vars(sex), scales = "free") +
  theme(legend.position = "none") +
  theme(axis.text.x = element_text(angle = 90)) +
  scale_fill_viridis(discrete = TRUE, option = "D")+
  labs(
    title = "What drugs are most popular among The dead (by Gender)?",
    subtitle = "Plot most popular drugs by Gender",
    caption = "Data source: Kaggle.com, Drug overdose deaths",
    x = "Drug Name",
    y = "Count"
  )

```

### What are the top 10 drugs are most popular among The dead (by Gender)?

```{r What the top 10 drugs are most popular among The dead (by Gender) }

DrugsPivot %>%
  filter(value != 0,
         sex != "Unknown") %>%
  group_by(drug_name, sex) %>%
  summarise(Count = sum(value), .groups = "drop") %>%
  top_n(10) %>% 
  ungroup() %>%
  mutate(sex = as.factor(sex),
         drug_name = reorder_within(drug_name, Count, sex)) %>%
  ggplot(aes(
    x = fct_reorder(drug_name, Count),
    y = Count,
    label = Count,
    fill = drug_name
  )) +
  geom_col(width = 0.8) +
  scale_y_continuous(expand = expansion(add = c(0, 600))) +
  geom_text(hjust = -0.1, size = 3.5) +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(vars(sex), scales = "free") +
  theme(legend.position = "none") +
  scale_fill_tableau(palette = "Tableau 20")+
  theme(axis.text.x = element_text(angle = 90)) +
  labs(
    title = "What drugs are most popular among The dead (by Gender)?",
    subtitle = "Plot Top 10 drugs by Gender",
    caption = "Data source: Kaggle.com, Drug overdose deaths",
    x = "Drug Name",
    y = "Count"
  )

```

Although there are duplicates generated by the fact that many died people were using multiple drugs in one session, this will not change the figure or the fact that heroin, fentanyl, cocaine, benzodiazepine and ethanol are the top 5 in this list.

> Note: Fentanyl is a powerful synthetic opioid that is similar to morphine but is 50 to 100 times more potent.

### Age groups VS deaths

I will use the original dataset "DrugDeath"

```{r Age groups VS deaths}

DrugDeathAgeGrp <- DrugDeath %>% select(id, age) %>% 
  filter(!is.na(age)) %>% mutate(age = as.numeric(age)) %>% 
  mutate(AgeGrp = as.factor(cut(age, breaks = c(14,20,30,49,65,Inf),
          labels = c("14-20", "21-29", "30-49", "50-65", "Over 65"))))


DrugDeathAgeGrp %>% filter(!is.na(AgeGrp)) %>% 
  group_by(AgeGrp) %>%
  summarise(Countind = n(), .groups = "drop") %>%
  arrange(desc(Countind)) %>%
  ggplot(aes(x = fct_reorder(AgeGrp, Countind), y = Countind, fill = AgeGrp, label = Countind )) +
  geom_col(width = 0.7) +
  coord_flip() +
  geom_text(hjust = -0.2, color = "steelblue", fontface = "bold") +
  scale_fill_tableau(palette = "Tableau 10") +
  theme(legend.position = "none") +
  theme(axis.text.x = element_text(angle = 90)) +
scale_y_continuous(expand = expansion(add = c(0,200)))+
  labs(
    title = "What Age groups have the most death?",
    subtitle = "Plot Age groups VS deaths",
    caption = "Data source: Kaggle.com, Drug overdose deaths",
    x = "Age groups",
    y = "Count"
  )

```

You know, we are talking about dead people not about how and at what age they started using drugs!

In this dataset! 30-49 years old are the most among others followed by 50-65, then 21-29

### Number of cases by year VS sex

```{r Number of cases by year VS sex (lolipop)}


DrugsPivot %>%
  filter(value != 0,
         sex != "Unknown",
         drug_name != "Unknown",
         !is.na(date)) %>%
  mutate(date = year(date)) %>%
  group_by(date,sex) %>%
  summarise(Count = n(), .groups = "drop") %>%
  ungroup() %>% 
ggplot(
       aes(
         x = date,
         y = Count,
         col = sex,
         size = Count,
         label = Count
       )) +
  geom_segment(aes(
    x = date,
    xend = date,
    y = 0,
    yend = Count
  ),
  color = "orange",
  size = 1) +
  geom_point(color = "darkgreen", size = 4) +
  geom_text(vjust = -1, size = 4) +
  facet_wrap( ~ sex) +
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 90),
    panel.spacing.x = unit(1, "lines")
  ) +
  scale_y_continuous(expand = expansion(add = c(0, 200))) +
  scale_x_continuous(expand = expansion(add = c(1, 1))) +
  labs(
    title = "Number of cases by year VS sex",
    subtitle = "Number of deaths by year VS sex",
    caption = "Data source: Kaggle.com, Drug overdose deaths",
    x = "Year",
    y = "Count"
  )
      


```

```{r Number of cases by year VS sex}

ggYear <- DrugDeath %>%
  filter(
         !is.na(sex),
         sex != "Unknown",
         !is.na(date)) %>%
  mutate(year = year(date)) %>%
  group_by(year, sex) %>%
  summarise(Count = n(), .groups = "drop") %>%
  ungroup() %>% 
  pivot_wider(names_from = sex, values_from = Count) %>% 
  rowwise() %>% 
  mutate(total = sum(c_across(Female:Male))) %>% 
  arrange(year) %>% 
  ungroup() %>%
  pivot_longer(cols = c("Male", "Female"),
                        names_to = "Gender") %>% 
  ggplot(
       aes(
         x = year,
         y = value,
         label = value
       )) +
  geom_col(alpha = 0.4, fill = "darkblue", width = 0.8) +
  geom_point(size = 1) +
  geom_line(aes(col = Gender), size = 1.5) +
  geom_text(vjust = -1, hjust = 0.6, angle = 25, col = "black", size = 3.7) +
   scale_color_tableau(palette = "Tableau 10") +
    theme(axis.text.x = element_text(angle = 90)) +
  scale_y_continuous(breaks = NULL) +
   labs(
    title = "Number of deaths by year VS sex",
    subtitle = "Number of deaths by year VS sex",
    x = "Year",
    y = "Count"
  )

```

### By month!

```{r by month}


ggMonth <- DrugDeath %>%
  filter(
         !is.na(sex),
         sex != "Unknown",
         !is.na(date)) %>%
  mutate(month = month(date, label = TRUE)) %>%
  group_by(month, sex) %>%
  summarise(Count = n(), .groups = "drop") %>%
  ungroup() %>% 
  pivot_wider(names_from = sex, values_from = Count) %>% 
  rowwise() %>% 
  mutate(total = sum(c_across(Female:Male))) %>% 
  arrange(month) %>% 
  ungroup() %>%
  pivot_longer(cols = c("Male", "Female"),
                        names_to = "Gender") %>% 
  ggplot(
       aes(
         x = fct_reorder(month,-value),
         y = value,
         label = value
       )) +
  geom_col(aes(fill = Gender),alpha = 0.4, width = 0.8, position = "dodge") +
  geom_point(size = 1) +
  geom_text(vjust = -0.3, hjust = 0.5, col = "black", size = 3.7) +
   scale_fill_tableau(palette = "Tableau 20") +
  scale_y_continuous(breaks = NULL) +
  theme(legend.position = "top") +
   labs(
    title = "Number of deaths by Month VS sex",
    subtitle = "Number of deaths by Month VS sex",
    x = "Year",
    y = "Count"
  )


```

### By weekdays!

```{r by weekdays}

ggWeekDays <- DrugDeath %>%
  filter(
         !is.na(sex),
         sex != "Unknown",
         !is.na(date)) %>%
  mutate(weekdays = weekdays(date)) %>%
  group_by(weekdays, sex) %>%
  summarise(Count = n(), .groups = "drop") %>%
  ungroup() %>% 
  pivot_wider(names_from = sex, values_from = Count) %>% 
  rowwise() %>% 
  mutate(total = sum(c_across(Female:Male))) %>% 
  arrange(weekdays) %>% 
  ungroup() %>%
  pivot_longer(cols = c("Male", "Female"),
                        names_to = "Gender") %>% 
  ggplot(
       aes(
         x = fct_reorder(weekdays,-value),
         y = value,
         label = value
       )) +
  geom_col(aes(fill = Gender), size = 1.5, alpha = 0.4, width = 0.8 , position = "dodge") +
  geom_point()+
  geom_text(vjust = -0.2, hjust = 0,col = "black", size = 4) +
  scale_fill_tableau(palette = "Tableau 10") +
  scale_y_continuous(breaks = NULL) +
  theme(legend.position = "top") +
   labs(
    title = "Number of deaths by WeekDays VS sex",
    subtitle = "Number of deaths by WeekDays VS sex",
    caption = "Data source: Kaggle.com, Drug overdose deaths",
    x = "WeekDays",
    y = "Count"
  )


```

```{r arrange dates plots , fig.width = 10, fig.height = 10}

ggYear / (ggMonth  + ggWeekDays)


```

The trend was up until 2018 it is flatten! this raising many questions, for now i will keep it like that!

Then, According to this dataset, same distribution between working days and weekend with Friday together ! Fri, Sat are the parties days!

let us check what kind of distribution we have by Age Group!

```{r age groups vs weekdays}

DrugDeathAgeGrpDate <- DrugDeath %>% select(id, age, date) %>% 
  filter(!is.na(age)) %>% mutate(age = as.numeric(age)) %>% 
  mutate(AgeGrp = as.factor(cut(age, breaks = c(14,20,30,49,65,Inf),
          labels = c("14-20", "21-29", "30-49", "50-65", "Over 65"))))


DrugDeathAgeGrpDate %>% filter(!is.na(AgeGrp),
                               !is.na(date)) %>% 
  mutate(days = wday(date, label = TRUE)) %>% 
  group_by(AgeGrp, days ) %>%
  summarise(Countind = n(), .groups = "drop") %>%
  arrange(desc(Countind)) %>%
  ggplot(aes(x = fct_reorder(AgeGrp, Countind), y = Countind, fill = AgeGrp, label = Countind )) +
  geom_col(width = 0.7) +
  coord_flip() +
  geom_text(hjust = -0.2, color = "steelblue", fontface = "bold") +
  facet_wrap(vars(days)) +
  scale_fill_tableau(palette = "Tableau 10") +
  theme(legend.position = "none") +
  theme(axis.text.x = element_text(angle = 90)) +
scale_y_continuous(expand = expansion(add = c(0,200)))+
  labs(
    title = "What age groups have the most death vs weekdays?",
    subtitle = "Plot age groups vs weekdays vs deaths",
    caption = "Data source: Kaggle.com, Drug overdose deaths",
    x = "Age groups",
    y = "Count"
  )


```

Almost same distribution!

let us see the distribution if we add race to age groups by weekdays!

```{r age groups by race have the most death vs weekdays, fig.height = 9, fig.width = 7 }

DrugDeathAgeGrpRaceDate <- DrugDeath %>% select(id, age, race, date) %>% 
  filter(!is.na(age),
         !is.na(date)) %>%
  mutate(age = as.numeric(age),
         day = wday(date, label = TRUE)) %>% 
  mutate(AgeGrp = as.factor(cut(age, breaks = c(14,20,30,49,65,Inf),
          labels = c("14-20", "21-29", "30-49", "50-65", "Over 65"))))


DrugDeathAgeGrpRaceDate %>% filter(!is.na(AgeGrp),
                               !is.na(race),
                               race %in% c("Black", "White", "Hispanic, White")) %>% 
  group_by(AgeGrp, race, day ) %>%
  summarise(Countind = n(), .groups = "drop") %>%
  arrange(desc(Countind)) %>%
  ggplot(aes(x = fct_reorder(AgeGrp, Countind), y = Countind, fill = AgeGrp, label = Countind )) +
  geom_col(width = 0.7) +
  coord_flip() +
  geom_text(hjust = -0.2, color = "steelblue", fontface = "bold") +
  facet_wrap(vars(race, day)) +
  scale_fill_tableau(palette = "Tableau 10") +
  theme(legend.position = "none") +
  theme(axis.text.x = element_text(angle = 90)) +
scale_y_continuous(expand = expansion(add = c(0,200)))+
  labs(
    title = "What age groups by race have the most death vs weekdays?",
    subtitle = "Plot age groups by race vs weekdays vs deaths",
    caption = "Data source: Kaggle.com, Drug overdose deaths",
    x = "Age groups",
    y = "Count"
  )


```

again, Almost same distribution, however the number of White people is more than others in this dataset

```{r age groups by Gender have the most death vs weekdays, fig.height = 9, fig.width = 7  }

DrugDeathAgeGrpSexDate <- DrugDeath %>% select(id, age, sex, date) %>% 
  filter(!is.na(age),
         !is.na(date)) %>%
  mutate(age = as.numeric(age),
         day = wday(date, label = TRUE)) %>% 
  mutate(AgeGrp = as.factor(cut(age, breaks = c(14,20,30,49,65,Inf),
          labels = c("14-20", "21-29", "30-49", "50-65", "Over 65"))))


DrugDeathAgeGrpSexDate %>% filter(!is.na(AgeGrp),
                               !is.na(sex)) %>% 
  group_by(AgeGrp, sex, day ) %>%
  summarise(Countind = n(), .groups = "drop") %>%
  arrange(desc(Countind)) %>%
  ggplot(aes(x = fct_reorder(AgeGrp, Countind), y = Countind, fill = AgeGrp, label = Countind )) +
  geom_col(width = 0.7) +
  coord_flip() +
  geom_text(hjust = -0.2, color = "steelblue", fontface = "bold") +
  facet_wrap(vars(sex, day)) +
  scale_fill_tableau(palette = "Tableau 10") +
  theme(legend.position = "none") +
  theme(axis.text.x = element_text(angle = 90)) +
scale_y_continuous(expand = expansion(add = c(0,200)))+
  labs(
    title = "What age groups by Gender have the most death vs weekdays?",
    subtitle = "Plot age groups by Gender vs weekdays vs deaths",
    caption = "Data source: Kaggle.com, Drug overdose deaths",
    x = "Age groups",
    y = "Count"
  )


```

Same distribution, however, the number of Female in this dataset is less then others.

### What drugs are most popular among The dead (by Race)?

```{r What drugs are most popular among The dead (by Race), fig.width = 9, fig.height = 7}
DrugsPivot %>% 
  filter(value != 0,
         sex != "Unknown",
         race != "Unknown" ) %>%
  mutate(race = fct_lump(race, n = 5)) %>%
  group_by(drug_name, race) %>%
  summarise(Count = sum(value), .groups = "drop") %>%
  ungroup() %>%
  mutate(race = as.factor(race),
         drug_name = reorder_within(drug_name, Count, race)) %>%
  ggplot(aes(
    x = fct_reorder(drug_name, Count),
    y = Count,
    label = Count,
    fill = drug_name
  )) +
  geom_col(width = 0.8) +
  scale_y_continuous(expand = expansion(add = c(0, 600))) +
  geom_text(hjust = -0.1, size = 2.5) +
  coord_flip() +
  scale_x_reordered() +
  facet_wrap(vars(race), scales = "free") +
  theme(legend.position = "none") +
  theme(axis.text.x = element_text(angle = 90)) +
  labs(
    title = "What drugs are most popular among The dead (by Race)?",
    subtitle = "Plot most popular drugs by Race",
    caption = "Data source: Kaggle.com, Drug overdose deaths",
    x = "Drug Name",
    y = "Count"
  )

```

-   White people died from herion and fentanyl overdose as top 2

-   Hispanic, White, died from herion and fentanyl overdose as top 2

-   Black people, died from cocaine and fentanyl then comes heroin.

-   The number of other races is less then Whit, Hespanic White and Black.

### Death Location vs Drug Name

```{r Death Location vs Drug Name}
  
 DrugsPivot %>% 
  mutate(location = fct_lump(location, n = 3)) %>% 
  select(location,value, drug_name) %>% 
  filter(location != "Unknown",
         value != 0,
         drug_name %in% c("heroin",
                          "fentanyl",
                          "fentanyl_analogue",
                          "cocaine",
                          "benzodiazepine",
                          "ethanol")) %>%
  group_by(drug_name, location) %>%
  summarise(value = sum(value), .groups = "drop") %>% 
   ggplot(aes( x = location, y = value, label = value, fill = location))+
   geom_col(width = 0.8) +
    geom_text(vjust = -0.3, size = 4) +
    theme(legend.position = "none") +
    scale_fill_tableau(palette = "Tableau 10") +
    scale_y_continuous(expand = expansion(add = c(0,300))) +
   facet_wrap(~drug_name, scale = "free_x") +
  theme(axis.text.x = element_text(angle = 90)) +
  theme(strip.background =element_rect(fill="#005824"))+
  theme(strip.text = element_text(colour = 'white', face = "bold"))+
  labs(
    title = "Death Location by Drug Name",
    subtitle = "Plot, Death Location facet by Drug Nmae ",
    caption = "Data source: Kaggle.com, Drug overdose deaths",
    x = "Location",
    y = "Count"
  )


```

Mainly and sadly, they found them died in their place, then in Hospital after they have admitted to it.

### Deaths distribution by states

```{r Deaths distribution by states, fig.width=8, fig.height= 8 }

DrugsPivot %>% select(residence_state, drug_name, value ) %>%
  mutate(residence_state = as.factor(residence_state)) %>% 
    mutate(residence_state = fct_lump(residence_state, n = 10)) %>% 
  filter(residence_state != "Unknown",
         value != 0,
         drug_name %in% c(
      "heroin",
      "cocaine",
      "oxycodone",
      "oxymorphone",
      "ethanol",
      "hydrocodone",
      "benzodiazepine",
      "methadone")) %>% 
  group_by(residence_state, drug_name, value) %>% 
  summarise(Count = sum(value), .groups = "drop") %>% 
  ungroup() %>% 
  arrange(desc(Count)) %>% 
  ggplot(aes( x = residence_state, y = Count, label = Count, fill = residence_state))+
   geom_col(width = 0.8) +
    geom_text(vjust = -0.5, size = 3) +
    theme(legend.position = "none") +
    scale_fill_viridis(discrete = TRUE, option = "D") +
    scale_y_continuous(expand = expansion(add = c(0,700))) +
   facet_wrap(~drug_name, scale = "free_x") +
  theme(axis.text.x = element_text(angle = 90)) +
  theme(strip.background =element_rect(fill="firebrick4"))+
  theme(strip.text = element_text(colour = 'white', face = "bold"))+
  labs(
    title = "Deaths distribution by states",
    subtitle = "Plot, Death Location facet by Drug Nmae ",
    caption = "Data source: Kaggle.com, Drug overdose deaths",
    x = "Loction",
    y = "Count"
  )
  
```

The State of Connecticut CT as i goggled, has the most records in this dataset, why? i do not not unless i missed something i do not know about! so if somebody has an idea about that please be generous and let me know!

now I will move to mannerof_death variable!

### Manner of death

```{r Manner of death}

MannerOfDeath <- DrugsPivot %>%
  filter(value != 0,
         sex != "Unknown",
         drug_name != "Unknown",
         !is.na(date),
         !is.na(mannerof_death)) %>%
  group_by(sex,mannerof_death) %>%
  summarise(Count = n(), .groups = "drop") %>%
  arrange(desc(Count))

datatable(MannerOfDeath)

```

I do not think i have to do a plot for this variable, at least for now! it is clear that they consider all this kind of death as accidents, unless they find some criminal event connected to drug overdose then it will go to other kind of dataset, i think so!

### Cause of death (cod)

```{r cod cause of death, fig.width = 10 }

 DrugDeath %>% mutate(cod = fct_lump(cod, n = 10)) %>%
  filter(!is.na(cod),
         cod != "Other",
         !is.na(sex)) %>% 
  group_by(cod, sex) %>% 
  summarise(total = n()) %>%
  arrange(desc(total)) %>% 
  ggplot(aes(x = fct_reorder(cod,total), y = total, fill = sex, label = total)) +
  geom_col(position = "dodge")+
  geom_point()+
  geom_text(hjust = -0.5, vjust = 0)+
  coord_flip()+
  scale_y_continuous(expand = expansion(add = c(0,20)))+
  scale_fill_tableau(palette = "Tableau 20") +
  labs(
    title = "What is the most cause of death anong the dead? ",
    subtitle = "Plot, the most cause of death anong the dea ",
    caption = "Data source: Kaggle.com, Drug overdose deaths",
    x = "cause of death",
    y = "Count"
  )


```

It is obvious according to what we found about the most Drug usage among the dead in this dataset!

I think we need to do a quick word cloud!

```{r word cloud!}


cod_words <- DrugDeath %>% select(id,cod) %>% 
    unnest_tokens(word, cod) %>%
    anti_join(stop_words)

count_word <- cod_words %>%
   count(word, sort = TRUE)


wordcloud(words = count_word$word,  
          freq = count_word$n, 
          min.freq = 5,  
          max.words = nrow(count_word), 
          random.order = FALSE,  
          rot.per = 0.1,  
          colors = brewer.pal(8, "Dark2")) 

```

1.  Acute Fentanyl Intoxication

2.  Acute Heroin Intoxication

3.  Heroin Intoxication

4.  Multiple Drug Toxicity

5.  Acute Heroin Toxicity

### 7 drugs in one session!

As I said in the beginning of this notebook, i want to know the record that contains 7 kind of drugs as Cause of death!

I will run the same code

```{r}

 datatable(DrugsPivot %>% filter(!is.na(value)) %>% 
  group_by(id) %>%
  summarise(Count = sum(value), .groups = "drop") %>%
    count(Count, id, sort = TRUE) %>% 
    arrange(desc(Count)),
          caption = NULL,
          options = list(dom = 't'))

 datatable(DrugDeath %>% select(id, sex, race, age, cod) %>% 
  filter(id == "18-0032"),caption = NULL,
          options = list(dom = 't'))

```

A sad story!

## Recommendations

As a parent, you are the biggest influence in your child's life and having open and honest conversations is one of the powerful ways to help them develop into healthy adults.

and personally, I believe that children must have something useful to do during their spare time such like sport, community service work, or involve them with parents' business so to not mix between fantasy and reality

-   Keep lines of communication open and make sure you come from a place of love and compassion -- even when you're having tough conversations.

-   Balance any consequences with positive encouragement.

-   Frequent touch points and teachable moments come up all the time

-   Make sure your child knows your rules --- and that you'll enforce the consequences if rules are broken.

-   Get to know your child's friends --- and their friends' parents.

-   Help children separate reality from fantasy.

Thanks for your reading and I defiantly know that i can do more than i did.

Thank you again, and please upvote if you liked it!

```